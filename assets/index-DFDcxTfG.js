(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const c={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"7b890de6-5366-4e72-bdab-ce1335543ece","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),z=()=>fetch(`${c.baseUrl}/users/me`,{headers:c.headers}).then(u),T=()=>fetch(`${c.baseUrl}/cards`,{headers:c.headers}).then(u),R=({name:e,about:t})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({name:e,about:t})}).then(u),V=({avatar:e})=>fetch(`${c.baseUrl}/users/me`,{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:e})}).then(u),K=({name:e,link:t})=>fetch(`${c.baseUrl}/cards`,{method:"POST",headers:c.headers,body:JSON.stringify({name:e,link:t})}).then(u),Z=e=>fetch(`${c.baseUrl}/cards/${e}`,{method:"DELETE",headers:c.headers}).then(u),G=(e,t)=>fetch(`${c.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:c.headers}).then(o=>u(o)),A=e=>{const t=e.closest(".card"),o=t.dataset.cardId,r=e.classList.contains("card__like-button_is-active"),n=t.querySelector(".card__like-count");G(o,r).then(s=>{e.classList.toggle("card__like-button_is-active"),n.textContent=s.likes.length}).catch(s=>{console.log(s)})},Q=e=>{const t=e.dataset.cardId;return Z(t).then(()=>{e.remove()})},X=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),$=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:r,userId:n})=>{const s=X(),l=s.querySelector(".card__like-button"),a=s.querySelector(".card__control-button_type_delete"),h=s.querySelector(".card__image"),H=s.querySelector(".card__like-count");return h.src=e.link,h.alt=e.name,s.querySelector(".card__title").textContent=e.name,s.dataset.cardId=e._id,H.textContent=e.likes.length,e.likes.some(J=>J._id===n)&&l.classList.add("card__like-button_is-active"),e.owner._id!==n&&a.remove(),o&&l.addEventListener("click",()=>o(l)),r&&a.addEventListener("click",()=>r(s)),t&&h.addEventListener("click",()=>t({name:e.name,link:e.link})),s},D=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");i(t)}},p=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",D)},i=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",D)},Y=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{i(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&i(e)})},w=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)},ee=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.textContent="",r.classList.remove(o.errorClass)},te=(e,t,o)=>{if(t.dataset.errorMessage&&!/^[A-Za-zА-Яа-яЁё\s-]+$/.test(t.value)){w(e,t,t.dataset.errorMessage,o);return}t.validity.valid?ee(e,t,o):w(e,t,t.validationMessage,o)},oe=e=>e.some(t=>!t.validity.valid),re=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},ne=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},B=(e,t,o)=>{oe(e)?re(t,o):ne(t,o)},se=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);B(o,r,t),o.forEach(n=>{n.addEventListener("input",()=>{te(e,n,t),B(o,r,t)})})},ce=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{se(o,e)})},U=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),_=(e,t)=>{const r=document.querySelector("#popup-info-definition-template").content.cloneNode(!0);return r.querySelector(".popup__info-term").textContent=e,r.querySelector(".popup__info-description").textContent=t,r},ae=e=>{const o=document.querySelector("#popup-info-user-preview-template").content.cloneNode(!0);return o.querySelector(".popup__list-item").textContent=e.name,o},le={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},F=document.querySelector(".places__list"),v=document.querySelector(".popup_type_edit"),b=v.querySelector(".popup__form"),O=b.querySelector(".popup__input_type_name"),N=b.querySelector(".popup__input_type_description"),C=document.querySelector(".popup_type_new-card"),y=C.querySelector(".popup__form"),ie=y.querySelector(".popup__input_type_card-name"),ue=y.querySelector(".popup__input_type_url"),g=document.querySelector(".popup_type_image"),M=g.querySelector(".popup__image"),de=g.querySelector(".popup__caption"),pe=document.querySelector(".profile__edit-button"),_e=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),E=document.querySelector(".popup_type_edit-avatar"),k=E.querySelector(".popup__form"),me=k.querySelector(".popup__input"),m=document.querySelector(".popup_type_info"),d=m.querySelector(".popup__info"),P=m.querySelector(".popup__list"),fe=document.querySelector(".header__logo"),I=document.querySelector(".popup_type_remove-card"),ye=I.querySelector(".popup__form");let S=null,f=null;const W=({name:e,link:t})=>{M.src=t,M.alt=e,de.textContent=e,p(g)},he=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0,R({name:O.value,about:N.value}).then(r=>{q.textContent=r.name,L.textContent=r.about,i(v)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=o,t.disabled=!1})},Se=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",t.disabled=!0,V({avatar:me.value}).then(r=>{x.style.backgroundImage=`url(${r.avatar})`,i(E)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=o,t.disabled=!1})},ve=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",t.disabled=!0,K({name:ie.value,link:ue.value}).then(r=>{F.prepend($(r,{onPreviewPicture:W,onLikeIcon:A,onDeleteCard:j,userId:S}))}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=o,t.disabled=!1,i(C)})},j=e=>{f=e,p(I)},be=e=>{e.preventDefault();const t=e.target.querySelector(".popup__button"),o=t.textContent;t.textContent="Удаление...",t.disabled=!0,f&&Q(f).then(()=>{f=null}).catch(r=>{console.log(r)}).finally(()=>{i(I),t.textContent=o,t.disabled=!1})};ye.addEventListener("submit",be);const Ce=()=>{T().then(e=>{d.innerHTML="",P.innerHTML="",m.querySelector(".popup__title").textContent="Статистика пользователей",m.querySelector(".popup__text").textContent="Все пользователи:";const t=[],o=new Set,r={};e.forEach(a=>{o.has(a.owner._id)||(o.add(a.owner._id),t.push(a.owner)),r[a.owner._id]=(r[a.owner._id]||0)+1});const n=e.length,s=t.length,l=Math.max(...Object.values(r));d.append(_("Всего карточек:",n)),d.append(_("Первая создана:",U(new Date(e[e.length-1].createdAt)))),d.append(_("Последняя создана:",U(new Date(e[0].createdAt)))),d.append(_("Всего пользователей:",s)),d.append(_("Максимум карточек от одного:",l)),t.forEach(a=>{P.append(ae(a))}),p(m)}).catch(e=>{console.log(e)})};b.addEventListener("submit",he);y.addEventListener("submit",ve);k.addEventListener("submit",Se);pe.addEventListener("click",()=>{O.value=q.textContent,N.value=L.textContent,p(v)});x.addEventListener("click",()=>{k.reset(),p(E)});_e.addEventListener("click",()=>{y.reset(),p(C)});fe.addEventListener("click",Ce);const ge=document.querySelectorAll(".popup");ge.forEach(e=>{Y(e)});ce(le);Promise.all([T(),z()]).then(([e,t])=>{S=t._id,q.textContent=t.name,L.textContent=t.about,x.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>{F.append($(o,{onPreviewPicture:W,onLikeIcon:A,onDeleteCard:j,userId:S}))})}).catch(e=>{console.log(e)});
